<!DOCTYPE html>
<html lang="en">
    <!-- title -->


    

<!-- keywords -->



<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="author" content="枳暮">
    <meta name="renderer" content="webkit">
    <meta name="copyright" content="枳暮">
    
        <meta name="keywords" content="hexo,hexo-theme,hexo-blog">
    
    <meta name="description" content="">
    <meta name="description" content="Docker is an open platform for developing, shipping, and running applications. It simplifies the process of building, running, managing, and distributing software by virtualizing the operating system">
<meta property="og:type" content="article">
<meta property="og:title" content="Docker">
<meta property="og:url" content="https://maplepoet.github.io/hexo/2024/03/07/Docker/index.html">
<meta property="og:site_name" content="枳暮">
<meta property="og:description" content="Docker is an open platform for developing, shipping, and running applications. It simplifies the process of building, running, managing, and distributing software by virtualizing the operating system">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2024-03-07T13:38:52.000Z">
<meta property="article:modified_time" content="2024-05-22T15:49:41.316Z">
<meta property="article:author" content="枳暮">
<meta name="twitter:card" content="summary">
    <meta http-equiv="Cache-control" content="no-cache">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <link rel="icon" href="/hexo/assets/favicon.ico">
    
    <title>Docker · 枳暮&#39;s Blog</title>
    <!-- /*! loadCSS. [c]2017 Filament Group, Inc. MIT License */
/* This file is meant as a standalone workflow for
- testing support for link[rel=preload]
- enabling async CSS loading in browsers that do not support rel=preload
- applying rel preload css once loaded, whether supported or not.
*/ -->
<script>
    (function (w) {
        'use strict'
        // rel=preload support test
        if (!w.loadCSS) {
            w.loadCSS = function () {}
        }
        // define on the loadCSS obj
        var rp = (loadCSS.relpreload = {})
        // rel=preload feature support test
        // runs once and returns a function for compat purposes
        rp.support = (function () {
            var ret
            try {
                ret = w.document.createElement('link').relList.supports('preload')
            } catch (e) {
                ret = false
            }
            return function () {
                return ret
            }
        })()

        // if preload isn't supported, get an asynchronous load by using a non-matching media attribute
        // then change that media back to its intended value on load
        rp.bindMediaToggle = function (link) {
            // remember existing media attr for ultimate state, or default to 'all'
            var finalMedia = link.media || 'all'

            function enableStylesheet() {
                link.media = finalMedia
            }

            // bind load handlers to enable media
            if (link.addEventListener) {
                link.addEventListener('load', enableStylesheet)
            } else if (link.attachEvent) {
                link.attachEvent('onload', enableStylesheet)
            }

            // Set rel and non-applicable media type to start an async request
            // note: timeout allows this to happen async to let rendering continue in IE
            setTimeout(function () {
                link.rel = 'stylesheet'
                link.media = 'only x'
            })
            // also enable media after 3 seconds,
            // which will catch very old browsers (android 2.x, old firefox) that don't support onload on link
            setTimeout(enableStylesheet, 3000)
        }

        // loop through link elements in DOM
        rp.poly = function () {
            // double check this to prevent external calls from running
            if (rp.support()) {
                return
            }
            var links = w.document.getElementsByTagName('link')
            for (var i = 0; i < links.length; i++) {
                var link = links[i]
                // qualify links to those with rel=preload and as=style attrs
                if (
                    link.rel === 'preload' &&
                    link.getAttribute('as') === 'style' &&
                    !link.getAttribute('data-loadcss')
                ) {
                    // prevent rerunning on link
                    link.setAttribute('data-loadcss', true)
                    // bind listeners to toggle media back
                    rp.bindMediaToggle(link)
                }
            }
        }

        // if unsupported, run the polyfill
        if (!rp.support()) {
            // run once at least
            rp.poly()

            // rerun poly on an interval until onload
            var run = w.setInterval(rp.poly, 500)
            if (w.addEventListener) {
                w.addEventListener('load', function () {
                    rp.poly()
                    w.clearInterval(run)
                })
            } else if (w.attachEvent) {
                w.attachEvent('onload', function () {
                    rp.poly()
                    w.clearInterval(run)
                })
            }
        }

        // commonjs
        if (typeof exports !== 'undefined') {
            exports.loadCSS = loadCSS
        } else {
            w.loadCSS = loadCSS
        }
    })(typeof global !== 'undefined' ? global : this)
</script>

    <style type="text/css">
    @font-face {
        font-family: 'Oswald-Regular';
        src: url("/hexo/font/Oswald-Regular.ttf");
    }

    body {
        margin: 0;
    }

    header,
    footer,
    .back-top,
    .sidebar,
    .container,
    .site-intro-meta,
    .toc-wrapper {
        display: none;
    }

    .site-intro {
        position: relative;
        z-index: 3;
        width: 100%;
        /* height: 50vh; */
        overflow: hidden;
    }

    .site-intro-placeholder {
        position: absolute;
        z-index: -2;
        top: 0;
        left: 0;
        width: calc(100% + 300px);
        height: 100%;
        background: repeating-linear-gradient(-45deg, #444 0, #444 80px, #333 80px, #333 160px);
        background-position: center center;
        transform: translate3d(-226px, 0, 0);
        animation: gradient-move 2.5s ease-out 0s infinite;
    }

    @keyframes gradient-move {
        0% {
            transform: translate3d(-226px, 0, 0);
        }
        100% {
            transform: translate3d(0, 0, 0);
        }
    }
</style>

    <link rel="preload" href="/hexo/css/style.css?v=20211217" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link rel="preload" href="/hexo/css/dark.css?v=20211217" as="style">
    <link rel="stylesheet" href="/hexo/css/dark.css">
    <link rel="stylesheet" href="/hexo/css/mobile.css?v=20211217" media="(max-width: 960px)">
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" as="script">
    <link rel="preload" href="/hexo/scripts/main.js?v=20211217" as="script">
    <link rel="preload" href="/hexo/scripts/dark.js?v=20211217" as="script">
    <link rel="preload" href="/hexo/font/Oswald-Regular.ttf" as="font" crossorigin>
    <link rel="preload" href="https://at.alicdn.com/t/font_327081_1dta1rlogw17zaor.woff" as="font" crossorigin>
    <!-- algolia -->
    
    <!-- 百度统计  -->
    
    <!-- Google tag (gtag.js) -->
    

<meta name="generator" content="Hexo 5.4.2"></head>

    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
    <script type="text/javascript">
        if (typeof window.$ == undefined) {
            console.warn('jquery load from jsdelivr failed, will load local script')
            document.write('<script src="/hexo/lib/jquery.min.js" />')
        }
    </script>
    
        <body class="post-body">
    
        <!-- header -->
        <header class="header header-mobile">
    <!-- top read progress line -->
    <div class="header-element">
        <div class="read-progress"></div>
    </div>
    <!-- sidebar menu button -->
    <div class="header-element">
        
            <div class="header-sidebar-menu">
        
            
                <div style="padding-left: 1px;">&#xe775;</div>
            
        </div>
    </div>
    <!-- header actions -->
    <div class="header-actions">
        <!-- theme mode switch button -->
        <span class="header-theme-btn header-element">
            <i class="fas fa-adjust"></i>
        </span>
        <!-- back to home page text -->
        <span class="home-link header-element">
            <a href=/hexo/>枳暮's Blog.</a>
        </span>
    </div>
    <!-- toggle banner for post layout -->
    
        
            <div class="banner">
        
            <div class="blog-title header-element">
                <a href="/hexo/">枳暮&#39;s Blog.</a>
            </div>
            <div class="post-title header-element">
                <a href="#" class="post-name">Docker</a>
            </div>
        </div>
    
</header>

        <!-- fixed footer -->
        <footer class="footer-fixed">
    <!-- back to top button -->
    <div class="footer-fixed-element">
        
            <div class="back-top back-top-hidden">
        
        
            <div>&#xe639;</div>
        
        </div>
    </div>
</footer>

        <!-- wrapper -->
        <div class="wrapper">
            <div class="site-intro" style="







    height:50vh;

">
    
    <!-- 主页  -->
    
        
    <!-- 404页  -->
    
    <div class="site-intro-placeholder"></div>
    <div class="site-intro-img" style="background-image: url(/hexo/intro/post-bg.jpg)"></div>
    <div class="site-intro-meta">
        <!-- 标题  -->
        <h1 class="intro-title">
            <!-- 主页  -->
            
                Docker
            <!-- 404 -->
            
        </h1>
        <!-- 副标题 -->
        <p class="intro-subtitle">
            <!-- 主页副标题  -->
            
                
            <!-- 404 -->
            
        </p>
        <!-- 文章页 meta -->
        
            <div class="post-intros">
                <!-- 文章页标签  -->
                
                    <div class= post-intro-tags >
    
    
</div>

                
                <!-- 文章字数统计 -->
                
                <div class="post-intro-meta">
                    <!-- 撰写日期 -->
                    <span class="iconfont-archer post-intro-calander">&#xe676;</span>
                    <span class="post-intro-time">2024/03/07</span>
                    <!-- busuanzi -->
                    
                        <span id="busuanzi_container_page_pv" class="busuanzi-pv">
                            <span class="iconfont-archer post-intro-busuanzi">&#xe602;</span>
                            <span id="busuanzi_value_page_pv"></span>
                        </span>
                    
                    <!-- 文章分享 -->
                    <span class="share-wrapper">
                        <span class="iconfont-archer share-icon">&#xe71d;</span>
                        <span class="share-text">Share</span>
                        <ul class="share-list">
                            <li class="iconfont-archer share-qr" data-type="qr">&#xe75b;
                                <div class="share-qrcode"></div>
                            </li>
                            <li class="iconfont-archer" data-type="weibo">&#xe619;</li>
                            <li class="iconfont-archer" data-type="qzone">&#xe62e;</li>
                            <li class="iconfont-archer" data-type="twitter">&#xe634;</li>
                            <li class="iconfont-archer" data-type="facebook">&#xe67a;</li>
                        </ul>
                    </span>
                </div>
            </div>
        
    </div>
</div>

            <script>
  // get user agent
  function getBrowserVersions() {
    var u = window.navigator.userAgent
    return {
      userAgent: u,
      trident: u.indexOf('Trident') > -1, //IE内核
      presto: u.indexOf('Presto') > -1, //opera内核
      webKit: u.indexOf('AppleWebKit') > -1, //苹果、谷歌内核
      gecko: u.indexOf('Gecko') > -1 && u.indexOf('KHTML') == -1, //火狐内核
      mobile: !!u.match(/AppleWebKit.*Mobile.*/), //是否为移动终端
      ios: !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/), //ios终端
      android: u.indexOf('Android') > -1 || u.indexOf('Linux') > -1, //android终端或者uc浏览器
      iPhone: u.indexOf('iPhone') > -1 || u.indexOf('Mac') > -1, //是否为iPhone或者安卓QQ浏览器
      iPad: u.indexOf('iPad') > -1, //是否为iPad
      webApp: u.indexOf('Safari') == -1, //是否为web应用程序，没有头部与底部
      weixin: u.indexOf('MicroMessenger') == -1, //是否为微信浏览器
      uc: u.indexOf('UCBrowser') > -1, //是否为android下的UC浏览器
    }
  }
  var browser = {
    versions: getBrowserVersions(),
  }
  console.log('userAgent: ' + browser.versions.userAgent)

  // callback
  function fontLoaded() {
    console.log('font loaded')
    if (document.getElementsByClassName('site-intro-meta')) {
      document
        .getElementsByClassName('intro-title')[0]
        .classList.add('intro-fade-in')
      document
        .getElementsByClassName('intro-subtitle')[0]
        .classList.add('intro-fade-in')
      var postIntros = document.getElementsByClassName('post-intros')[0]
      if (postIntros) {
        postIntros.classList.add('post-fade-in')
      }
    }
  }

  // UC不支持跨域，所以直接显示
  function asyncCb() {
    if (browser.versions.uc) {
      console.log('UCBrowser')
      fontLoaded()
    } else {
      WebFont.load({
        custom: {
          families: ['Oswald-Regular'],
        },
        loading: function () {
          // 所有字体开始加载
          // console.log('font loading');
        },
        active: function () {
          // 所有字体已渲染
          fontLoaded()
        },
        inactive: function () {
          // 字体预加载失败，无效字体或浏览器不支持加载
          console.log('inactive: timeout')
          fontLoaded()
        },
        timeout: 5000, // Set the timeout to two seconds
      })
    }
  }

  function asyncErr() {
    console.warn('script load from CDN failed, will load local script')
  }

  // load webfont-loader async, and add callback function
  function async(u, cb, err) {
    var d = document,
      t = 'script',
      o = d.createElement(t),
      s = d.getElementsByTagName(t)[0]
    o.src = u
    if (cb) {
      o.addEventListener(
        'load',
        function (e) {
          cb(null, e)
        },
        false
      )
    }
    if (err) {
      o.addEventListener(
        'error',
        function (e) {
          err(null, e)
        },
        false
      )
    }
    s.parentNode.insertBefore(o, s)
  }

  var asyncLoadWithFallBack = function (arr, success, reject) {
    var currReject = function () {
      reject()
      arr.shift()
      if (arr.length) async(arr[0], success, currReject)
    }

    async(arr[0], success, currReject)
  }

  asyncLoadWithFallBack(
    [
      'https://cdn.jsdelivr.net/npm/webfontloader@1.6.28/webfontloader.min.js',
      'https://cdn.bootcss.com/webfont/1.6.28/webfontloader.js',
      "/hexo/lib/webfontloader.min.js",
    ],
    asyncCb,
    asyncErr
  )
</script>

            <img class="loading" src="/hexo/assets/loading.svg" style="display: block; margin: 6rem auto 0 auto; width: 6rem; height: 6rem;" />
            <div class="container container-unloaded">
                <main class="main post-page">
    <article class="article-entry">
        <p>Docker is an open platform for developing, shipping, and running applications. It simplifies the process of building, running, managing, and distributing software by virtualizing the operating system of the host computer. </p>
<span id="more"></span>

<h1 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h1><h2 id="Basic"><a href="#Basic" class="headerlink" title="Basic"></a>Basic</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">docker container run -d --name mysql -e MYSQL_ALLOW_EMPTY_PASSWORD=True mysql</span><br><span class="line"><span class="comment"># Run the container</span></span><br><span class="line">docker container logs xxx</span><br><span class="line"><span class="comment"># show the logs</span></span><br><span class="line">docker container top xxx</span><br><span class="line"><span class="comment"># process list in one container</span></span><br><span class="line">docker container inspect xxx</span><br><span class="line"><span class="comment"># show metadata about the container (startup, config, volumes, networking, etc)</span></span><br><span class="line">docker container stats xxx</span><br><span class="line"><span class="comment"># Show live performance data for all containers</span></span><br><span class="line">dockerr container run --<span class="built_in">rm</span> -it --name namexx -p 8080:80 xxx </span><br><span class="line"><span class="comment"># i means interactively, t means pseudo tty.</span></span><br><span class="line"><span class="comment"># Start --it container interactively </span></span><br><span class="line"><span class="comment"># after exit, docker container start -ai xxx to enter the container</span></span><br><span class="line"></span><br><span class="line">docker container <span class="built_in">exec</span> -it xxx <span class="string">&quot;commands&quot;</span></span><br><span class="line"><span class="comment"># run additional command in existing container</span></span><br><span class="line"></span><br><span class="line">docker container port xxx (name)</span><br><span class="line"></span><br><span class="line">docker container inspect --format <span class="string">&#x27;&#123;&#123;.NetworkSettings.IPAddress &#125;&#125;&#x27;</span> xxx (name)</span><br><span class="line"><span class="comment"># a common option for formatting the output of commands using &quot;Go templates&quot;</span></span><br></pre></td></tr></table></figure>





<h2 id="Network"><a href="#Network" class="headerlink" title="Network"></a>Network</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">docker network <span class="built_in">ls</span></span><br><span class="line"><span class="comment"># List all docker networks</span></span><br><span class="line">docker network <span class="built_in">ls</span> --network bridge </span><br><span class="line"><span class="comment"># default docker virtual network, which is NAT&quot;ed behind the Host IP</span></span><br><span class="line">docker network <span class="built_in">ls</span> --network host</span><br><span class="line"><span class="comment"># It gains performance by skipping virtual machine but sacrifices security of container model</span></span><br><span class="line"></span><br><span class="line">docker entwork <span class="built_in">ls</span> --network none</span><br><span class="line"><span class="comment"># removes eth0 and only leaves you with localhost interface in container</span></span><br><span class="line"></span><br><span class="line">docker network inspect</span><br><span class="line">docker network create --driver xxx</span><br><span class="line"><span class="comment"># Spawns a new virtual network for you to attach containers to</span></span><br><span class="line"></span><br><span class="line">docker container run ... --network xxx</span><br><span class="line"></span><br><span class="line">docker network connect xxx(network) xxx(container)</span><br><span class="line"></span><br><span class="line">docker network disconnect</span><br></pre></td></tr></table></figure>





<h2 id="Docker-Network-DNS"><a href="#Docker-Network-DNS" class="headerlink" title="Docker Network DNS"></a>Docker Network DNS</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker container <span class="built_in">exec</span> -it my_nginx ping old_ngingx (name of other container)</span><br><span class="line"><span class="comment"># Assignment: Round Robin Test</span></span><br><span class="line"></span><br><span class="line">docker image <span class="built_in">history</span> nginx:latest</span><br><span class="line"><span class="comment"># show layers of changes made in image </span></span><br></pre></td></tr></table></figure>



<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker pull</span><br><span class="line">docker login</span><br><span class="line">docker tag</span><br><span class="line">docker push</span><br></pre></td></tr></table></figure>



<h2 id="PRUNE"><a href="#PRUNE" class="headerlink" title="PRUNE"></a>PRUNE</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">docker system <span class="built_in">df</span> </span><br><span class="line"><span class="comment"># see space usage</span></span><br><span class="line"></span><br><span class="line">docker system prune</span><br><span class="line"><span class="comment"># clean up everything you&quot;re not currently using</span></span><br><span class="line"></span><br><span class="line">docker image prune -a</span><br><span class="line"><span class="comment"># remove all iamges you&#x27;re not using</span></span><br><span class="line"></span><br><span class="line">docker image prune</span><br><span class="line"><span class="comment"># clean up just &quot;dangling&quot; images</span></span><br></pre></td></tr></table></figure>





<h2 id="Persistent-Data"><a href="#Persistent-Data" class="headerlink" title="Persistent Data"></a>Persistent Data</h2><p>VOLUME path</p>
<p>After run docker container inspect xx</p>
<p>“Mounts”: </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">docker volume <span class="built_in">ls</span></span><br><span class="line">docker volume inspect xxx(<span class="built_in">id</span>)</span><br><span class="line">docker run .. -v mysql-db:/var/lib/mysql ...</span><br><span class="line"></span><br><span class="line"><span class="comment"># name for the volume: mysql-db</span></span><br><span class="line">docker volume create </span><br><span class="line"></span><br><span class="line"><span class="comment"># Shell differences for path expansion (Bind Mounting)</span></span><br><span class="line"><span class="comment"># Map host file to a container file or directiory </span></span><br><span class="line"><span class="comment"># Can not used in Dockerfile, but must with docker contaienr run</span></span><br><span class="line">... run -v /Users/xxx:/path/container Linux mac</span><br><span class="line">... run -v //c/User/xxx:/path/container windows </span><br><span class="line"></span><br><span class="line">-e POSTGRES_PASSWORD=mypassword</span><br><span class="line">-e POSTGRES_HOST_AUTH_METHOD=trust</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<blockquote>
<p>Jekyll “static site generator”</p>
</blockquote>
<h2 id="Docker-Compose"><a href="#Docker-Compose" class="headerlink" title="Docker Compose"></a>Docker Compose</h2><ol>
<li>YML file: containers, network, volumes</li>
<li>Docker-compose tool for local dev&#x2F;test automation</li>
</ol>
<p><strong>Docker-compose.yml</strong></p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># version isn&#x27;t needed as of 2020 for docker compose CLI. </span></span><br><span class="line"><span class="comment"># All 2.x and 3.x features supported</span></span><br><span class="line"><span class="comment"># Docker Swarm still needs a 3.x version</span></span><br><span class="line"><span class="comment"># version: &#x27;3.9&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span>  <span class="comment"># containers. same as docker run</span></span><br><span class="line">  <span class="attr">servicename:</span> <span class="comment"># a friendly name. this is also DNS name inside network</span></span><br><span class="line">    <span class="attr">image:</span> <span class="comment"># Optional if you use build:</span></span><br><span class="line">    <span class="attr">command:</span> <span class="comment"># Optional, replace the default CMD specified by the image</span></span><br><span class="line">    <span class="attr">environment:</span> <span class="comment"># Optional, same as -e in docker run</span></span><br><span class="line">    <span class="attr">volumes:</span> <span class="comment"># Optional, same as -v in docker run</span></span><br><span class="line">  <span class="attr">servicename2:</span></span><br><span class="line"></span><br><span class="line"><span class="attr">volumes:</span> <span class="comment"># Optional, same as docker volume create</span></span><br><span class="line"></span><br><span class="line"><span class="attr">networks:</span> <span class="comment"># Optional, same as docker network create</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Docker-compose up</span><br><span class="line">docker-compose down</span><br><span class="line">docker-compose up --build</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">services:</span><br><span class="line">  proxy:</span><br><span class="line">    build:</span><br><span class="line">      context: .</span><br><span class="line">      dockerfile: nginx.Dockerfile</span><br><span class="line">    ports:</span><br><span class="line">      - &#x27;80:80&#x27;</span><br><span class="line">  web:</span><br><span class="line">    image: httpd</span><br><span class="line">    volumes:</span><br><span class="line">      - ./html:/usr/local/apache2/htdocs/</span><br></pre></td></tr></table></figure>

<h2 id="Swarm"><a href="#Swarm" class="headerlink" title="Swarm"></a>Swarm</h2><p>Clustering solution built inside Docker</p>
<p><strong>Raft consensus Group</strong>, Gossip network</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker swarm init</span><br></pre></td></tr></table></figure>

<p>Lots of PKI and security automation</p>
<ul>
<li><p>root signing certificate created for swarm</p>
</li>
<li><p>Certificate is issued for the first Manager node</p>
</li>
<li><p>join tokens are created</p>
</li>
</ul>
<p>Raft database created to store root CA, config and secrets</p>
<ul>
<li><p>Encrypted by default on disk</p>
</li>
<li><p>no need for another key&#x2F;value system to hold orchestration&#x2F;secrets</p>
</li>
<li><p>Replicas logs amongst Manager via mutual TLS in “control plane”</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">docker service create alpine ping 8.8.8.8</span><br><span class="line"></span><br><span class="line">docker service <span class="built_in">ls</span></span><br><span class="line"></span><br><span class="line">docker service ps xxx(name)</span><br><span class="line"></span><br><span class="line">docker service update xx(ID) --replicas 3</span><br><span class="line"></span><br><span class="line">docker update</span><br><span class="line"></span><br><span class="line">docker containerr <span class="built_in">rm</span> -f xxx.1.xxx</span><br><span class="line"></span><br><span class="line">Docker swarm init</span><br><span class="line"></span><br><span class="line">Docker swarm init --advertise-addr xxx(ip address)</span><br><span class="line"></span><br><span class="line">docker node <span class="built_in">ls</span></span><br><span class="line"></span><br><span class="line">docker node update --role manager node2</span><br><span class="line"></span><br><span class="line">docker swarm <span class="built_in">join</span> xxxx xxxx</span><br><span class="line"></span><br><span class="line">docker swarm join-token manager (For <span class="built_in">join</span> a new node)</span><br><span class="line"></span><br><span class="line">docker service create --replicas 3 alpine ping 8.8.8.8</span><br><span class="line"></span><br><span class="line">docker node ps node1/node2</span><br></pre></td></tr></table></figure>



<h2 id="Overlay-Network"><a href="#Overlay-Network" class="headerlink" title="Overlay Network"></a>Overlay Network</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">--driver overlay</span><br></pre></td></tr></table></figure>

<p>for container-to-container traffic inside a single swarm</p>
<p>Optional IPSec(AES) encrpytion on network creation</p>
<p>Each service can be connected to multiple networks</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">docker network create --driver overlay mydrupal</span><br><span class="line"></span><br><span class="line">docker network ls</span><br><span class="line"></span><br><span class="line">docker service create --name psql --network mydrupal -e xxx postgres</span><br><span class="line"></span><br><span class="line">docker service ps psql</span><br><span class="line"></span><br><span class="line">docker container logs psql.1.xxx</span><br><span class="line"></span><br><span class="line">docker serrvice create --name drupal --network mydrupal -p 80:80 drupal</span><br><span class="line"></span><br><span class="line">watch docker service ls</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="scaling-out-with-Routing-Mesh"><a href="#scaling-out-with-Routing-Mesh" class="headerlink" title="scaling out with Routing Mesh"></a>scaling out with Routing Mesh</h3><p>Routes ingress packets for a Service to proper Task</p>
<p>span all nodes in swarm</p>
<p>Uses IPVS from Linux Kernel</p>
<p>Load balances Swarm services across their taks</p>
<p>Two ways:</p>
<ul>
<li>container to container in a Overlay network (use VIP)</li>
<li>External traffic incoming to published ports (all nodes listen)</li>
</ul>
<p>stateless load balancing , OSI Layer 3 (TCP), not Layer 4(DNS)</p>
<p>both limitation can be overcome with nginx or HAProxy LB proxy</p>
<p>Docker Enterprise Edition comes with built-in L4 web proxy</p>
<h3 id="swarm-stacks"><a href="#swarm-stacks" class="headerlink" title="swarm stacks"></a>swarm stacks</h3><p>use docker stack deploy rather than docker service create</p>
<p>compose ignores deploy, swarm ignore build</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;3.9&quot;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">redis:alpine</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">frontend</span></span><br><span class="line">  <span class="attr">db:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">postgres:13</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">db-data:/var/lib/postgresql/data</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">backend</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">POSTGRES_HOST_AUTH_METHOD=trust</span></span><br><span class="line">    <span class="attr">deploy:</span></span><br><span class="line">  <span class="attr">vote:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">bretfisher/examplevotingapp_vote</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;5000:80&quot;</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">frontend</span></span><br><span class="line">    <span class="attr">deploy:</span></span><br><span class="line">      <span class="attr">mode:</span> <span class="string">global</span></span><br><span class="line">  <span class="attr">result:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">bretfisher/examplevotingapp_result</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;5001:80&quot;</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">backend</span></span><br><span class="line">  <span class="attr">worker:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">bretfisher/examplevotingapp_worker</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">frontend</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">backend</span></span><br><span class="line">    <span class="attr">deploy:</span></span><br><span class="line">      <span class="attr">mode:</span> <span class="string">global</span></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">frontend:</span></span><br><span class="line">  <span class="attr">backend:</span></span><br><span class="line"><span class="attr">volumes:</span></span><br><span class="line">  <span class="attr">db-data:</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker stack deploy -c xxx.yml voteapp</span><br><span class="line"></span><br><span class="line">docker stack ps voteapp (list all nodes)</span><br><span class="line"></span><br><span class="line">docker stack services voteapp (list all service)</span><br></pre></td></tr></table></figure>



<h3 id="Secret-Storage-in-Swarm"><a href="#Secret-Storage-in-Swarm" class="headerlink" title="Secret Storage in Swarm"></a>Secret Storage in Swarm</h3><ul>
<li>Username passwords</li>
<li>TLS certificate and keys</li>
<li>SSH keys</li>
<li>Any data you would prefer not be on front page of news</li>
</ul>
<p>swarm RAFT DB is encrypted on disk</p>
<p>only stored on disk on manager nodes</p>
<p>Default is managers and workers contorl plane is TLS + Mutual Auth</p>
<p>secrets are first stored in swarm, then assigned to service</p>
<p>only containers is assigned Service can see them</p>
<p>they look like files in containers but are actually in-memory file system</p>
<p>Local docker-compose can use file-based secrets, but not secure</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">docker secret create psql_user sql_user.txt</span><br><span class="line"></span><br><span class="line">Echo <span class="string">&quot;myDBxxx&quot;</span> | docker secret create psql_pass - </span><br><span class="line"></span><br><span class="line">docker secret <span class="built_in">ls</span></span><br><span class="line"></span><br><span class="line">docker secret inspect psql_user</span><br><span class="line"></span><br><span class="line">Docker service create --name psql --secret psql_user --secret psql_pass -e POSTGRES_PASSWORD_FILE=/run/secrets/psql_pass -e POSTGRES_USER_FILE=/run/secrets/psql_userr postgres</span><br><span class="line"></span><br><span class="line">docker service ps psql</span><br><span class="line"></span><br><span class="line">docker <span class="built_in">exec</span> -it psql.1.xxx</span><br><span class="line"></span><br><span class="line"><span class="built_in">ls</span> /run/secrets</span><br><span class="line"></span><br><span class="line">docker logs psql.1.xx</span><br><span class="line"></span><br><span class="line">docker service update --secret-rm</span><br><span class="line"></span><br><span class="line">docker service create --name search --replicas 3 -p 9200:9200 elasticsearch:2</span><br><span class="line">docker stack deploy -c xxx.yml mydb</span><br><span class="line">docker stack <span class="built_in">rm</span> mydb</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="Docker-compose-for-Full-App-Lifecycle"><a href="#Docker-compose-for-Full-App-Lifecycle" class="headerlink" title="Docker compose for Full App Lifecycle"></a>Docker compose for Full App Lifecycle</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker-compose up</span><br><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure>

<p>When you run <code>docker-compose up</code>, it searches for a file named <code>docker-compose.yml</code> and reads all configured services, networks, volumes etc to create your Docker stack. If you also additionally have a file named <code>docker-compose.override.yml</code> this will be read as well and used as an override file to complement. It works in the following order:</p>
<ol>
<li>All definitions from <code>docker-compose.yml</code> will be used</li>
<li>All definitions that are also defined in <code>docker-compose.override.yml</code> will automatically overwrite the settings from <code>docker-compose.yml</code></li>
<li>All definitions only available in <code>docker-compose.override.yml</code> will be added additionally.</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker-compose -f docker-compose.yml -f docker-compose.test.yml up -d</span><br><span class="line"></span><br><span class="line">docker-compose -f docker-compose.yml -f docker-compose.prod.yml config &gt; output.yml</span><br></pre></td></tr></table></figure>



<h3 id="Update-service"><a href="#Update-service" class="headerlink" title="Update service"></a>Update service</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">docker service update --image xxx xxx(service name)</span><br><span class="line"><span class="comment"># Just update the image used to a newer version</span></span><br><span class="line"></span><br><span class="line">docker service update --env-add NODE_ENV=production --publish-rm 8080</span><br><span class="line"><span class="comment"># Adding an environment variable and remove a port</span></span><br><span class="line"></span><br><span class="line">docker service scale web=8 api=6</span><br><span class="line"><span class="comment"># change number of replicas of two services</span></span><br><span class="line"></span><br><span class="line">docker stack deploy -c xxx.yml &lt;stackname&gt;</span><br><span class="line"><span class="comment"># same command. just edit the yaml file and then </span></span><br><span class="line"></span><br><span class="line">Docker service rollback</span><br><span class="line"></span><br><span class="line">docker service update --force xxx(serrvice name)</span><br></pre></td></tr></table></figure>



<h3 id="health-check-in-Dockerfile"><a href="#health-check-in-Dockerfile" class="headerlink" title="health check in Dockerfile"></a>health check in Dockerfile</h3><p>supported in Dockerfile, compose yaml, docker run and swarm services </p>
<p>it expects exit 0 (OK) and exit 1 (Error)</p>
<p>three states: starting, healthy, unhealthy</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">docker container <span class="built_in">ls</span></span><br><span class="line"></span><br><span class="line">docker container inspect (last 5 health checks )</span><br><span class="line"><span class="comment"># service will replace tasks if they fail healthcheck</span></span><br><span class="line"></span><br><span class="line">docker run --health-cmd=<span class="string">&quot;curl -f localhost:9200/\_cluster/heath || false&quot;</span></span><br><span class="line"></span><br><span class="line">--health-interval=5s --health-retries=3 --health-timeout=2s --health-start-period=15s </span><br><span class="line"></span><br><span class="line">--interval --<span class="built_in">timeout</span> --start-period --retries</span><br></pre></td></tr></table></figure>



<h2 id="Container-Registries"><a href="#Container-Registries" class="headerlink" title="Container Registries"></a>Container Registries</h2><p>Private docker registry </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Run the registry image</span></span><br><span class="line">docker container run -d -p 5000:5000 --name registry registry</span><br><span class="line"></span><br><span class="line"><span class="comment"># Re-tag an existing image and push it to.your new registry</span></span><br><span class="line">docker tag hello-world 127.0.0.1:5000/hello-world</span><br><span class="line">docker push 127.0.0.1:5000/hello-world</span><br><span class="line"></span><br><span class="line"><span class="comment"># Remove the image from local cache and pull it from new registry</span></span><br><span class="line">docker image remove hello-world</span><br><span class="line">docker image remove 127.0.0.1:5000/hello-world</span><br><span class="line">docker pull 172.0.0.1:5000/hello-world</span><br><span class="line"></span><br><span class="line"><span class="comment"># Re-create registry using a bind mount and see how it stores data</span></span><br><span class="line">docker container run -d -p 5000:5000 --name registry -v $(<span class="built_in">pwd</span>)/registry-data:/var/lib/registry registry</span><br><span class="line"></span><br></pre></td></tr></table></figure>


    </article>
    <!-- license -->
    
        <div class="license-wrapper">
            <p>Author：<a href="https://maplepoet.github.io/hexo">枳暮</a>
            <p>Link：<a href="https://maplepoet.github.io/hexo/2024/03/07/Docker/">https://maplepoet.github.io/hexo/2024/03/07/Docker/</a>
            <p>Publish date：<a href="https://maplepoet.github.io/hexo/2024/03/07/Docker/">March 7th 2024, 2:38:52 pm</a>
            <p>Update date：<a href="https://maplepoet.github.io/hexo/2024/03/07/Docker/">May 22nd 2024, 5:49:41 pm</a>
            <p>License：本文采用<a rel="license noopener" target="_blank" href="http://creativecommons.org/licenses/by-nc/4.0/">知识共享署名-非商业性使用 4.0 国际许可协议</a>进行许可</p>
        </div>
    
    <!-- paginator -->
    <ul class="post-paginator">
        <li class="next">
            
                <div class="nextSlogan">Next Post</div>
                <a href="/hexo/2024/03/07/Kubernetes/" title="Kubernetes">
                    <div class="nextTitle">Kubernetes</div>
                </a>
            
        </li>
        <li class="previous">
            
                <div class="prevSlogan">Previous Post</div>
                <a href="/hexo/2024/03/07/Terraform/" title="Terraform">
                    <div class="prevTitle">Terraform</div>
                </a>
            
        </li>
    </ul>
    <!-- comment -->
    
        <div class="post-comment">
            <!-- 来必力 City 版安装代码 -->


            

            

            

            <!-- utteranc评论 -->


            <!-- partial('_partial/comment/changyan') -->
            <!--PC版-->


            
            

            

        </div>
    
    <!-- timeliness note -->
    <!-- idea from: https://hexo.fluid-dev.com/posts/hexo-injector/#%E6%96%87%E7%AB%A0%E6%97%B6%E6%95%88%E6%80%A7%E6%8F%90%E7%A4%BA -->
    
    <!-- Mathjax -->
    
</main>

                <!-- profile -->
                
            </div>
            <footer class="footer footer-unloaded">
    <!-- social  -->
    
        <div class="social">
            
    
        
            
                <a href="mailto:aaronshan96@outlook.com" class="iconfont-archer email" title=email ></a>
            
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    


        </div>
    
    <!-- powered by Hexo  -->
    <div class="copyright">
        <span id="hexo-power">Powered by <a href="https://hexo.io/" target="_blank">Hexo</a></span><span class="iconfont-archer power">&#xe635;</span><span id="theme-info">theme <a href="https://github.com/fi3ework/hexo-theme-archer" target="_blank">Archer</a></span>
    </div>
    <!-- website approve for Chinese user -->
    
    <!-- 不蒜子  -->
    
        <div class="busuanzi-container">
            
             
                <span id="busuanzi_container_site_pv">PV: <span id="busuanzi_value_site_pv"></span> :)</span>
            
        </div>
    	
</footer>

        </div>
        <!-- toc -->
        
            <div class="toc-wrapper toc-wrapper-loding" style=







    top:50vh;

>
                <div class="toc-catalog">
                    <span class="iconfont-archer catalog-icon">&#xe613;</span><span>CATALOG</span>
                </div>
                <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Docker"><span class="toc-number">1.</span> <span class="toc-text">Docker</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Basic"><span class="toc-number">1.1.</span> <span class="toc-text">Basic</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Network"><span class="toc-number">1.2.</span> <span class="toc-text">Network</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker-Network-DNS"><span class="toc-number">1.3.</span> <span class="toc-text">Docker Network DNS</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#PRUNE"><span class="toc-number">1.4.</span> <span class="toc-text">PRUNE</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Persistent-Data"><span class="toc-number">1.5.</span> <span class="toc-text">Persistent Data</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker-Compose"><span class="toc-number">1.6.</span> <span class="toc-text">Docker Compose</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Swarm"><span class="toc-number">1.7.</span> <span class="toc-text">Swarm</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Overlay-Network"><span class="toc-number">1.8.</span> <span class="toc-text">Overlay Network</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#scaling-out-with-Routing-Mesh"><span class="toc-number">1.8.1.</span> <span class="toc-text">scaling out with Routing Mesh</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#swarm-stacks"><span class="toc-number">1.8.2.</span> <span class="toc-text">swarm stacks</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Secret-Storage-in-Swarm"><span class="toc-number">1.8.3.</span> <span class="toc-text">Secret Storage in Swarm</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker-compose-for-Full-App-Lifecycle"><span class="toc-number">1.9.</span> <span class="toc-text">Docker compose for Full App Lifecycle</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Update-service"><span class="toc-number">1.9.1.</span> <span class="toc-text">Update service</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#health-check-in-Dockerfile"><span class="toc-number">1.9.2.</span> <span class="toc-text">health check in Dockerfile</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Container-Registries"><span class="toc-number">1.10.</span> <span class="toc-text">Container Registries</span></a></li></ol></li></ol>
            </div>
        
        <!-- sidebar -->
        <div class="sidebar sidebar-hide">
    <ul class="sidebar-tabs sidebar-tabs-active-0">
        <li class="sidebar-tab-archives"><span class="iconfont-archer">&#xe67d;</span><span class="tab-name">Archive</span></li>
        <li class="sidebar-tab-tags"><span class="iconfont-archer">&#xe61b;</span><span class="tab-name">Tag</span></li>
        <li class="sidebar-tab-categories"><span class="iconfont-archer">&#xe666;</span><span class="tab-name">Cate</span></li>
    </ul>
    <div class="sidebar-content sidebar-content-show-archive">
        <div class="sidebar-panel-archives">
    <!-- 在 ejs 中将 archive 按照时间排序 -->
    
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
    
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
    
    
    
    
    <div class="total-and-search">
        <div class="total-archive">
        Total : 11
        </div>
        <!-- search  -->
        
    </div>
    
    <div class="post-archive">
    
        
            
            
            <div class="archive-year"> 2024 </div>
            <ul class="year-list">
            
        
        <li class="archive-post-item">
            <span class="archive-post-date">05/22</span>
            <a class="archive-post-title" href="/hexo/2024/05/22/AWS-Solution-Architect/">AWS Solution Architect</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">05/22</span>
            <a class="archive-post-title" href="/hexo/2024/05/22/PostgreSQL/">PostgreSQL</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">05/22</span>
            <a class="archive-post-title" href="/hexo/2024/05/22/VueJS/">VueJS</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">03/07</span>
            <a class="archive-post-title" href="/hexo/2024/03/07/AWS/">AWS</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">03/07</span>
            <a class="archive-post-title" href="/hexo/2024/03/07/Ansible/">Ansible</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">03/07</span>
            <a class="archive-post-title" href="/hexo/2024/03/07/Docker/">Docker</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">03/07</span>
            <a class="archive-post-title" href="/hexo/2024/03/07/Kafka-Zookeeper/">Kafka Zookeeper</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">03/07</span>
            <a class="archive-post-title" href="/hexo/2024/03/07/Kubernetes/">Kubernetes</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">03/07</span>
            <a class="archive-post-title" href="/hexo/2024/03/07/Terraform/">Terraform</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">03/07</span>
            <a class="archive-post-title" href="/hexo/2024/03/07/WSL-usage/">WSL usage</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">03/07</span>
            <a class="archive-post-title" href="/hexo/2024/03/07/hello-world/">Hello World</a>
        </li>
    
    </div>
</div>

        <div class="sidebar-panel-tags">
    <div class="sidebar-tags-name">
        
            <span class="sidebar-tag-name" data-tags="WSL">
                <span class="iconfont-archer">&#xe606;</span>
                WSL
            </span>
        
            <span class="sidebar-tag-name" data-tags="Linux">
                <span class="iconfont-archer">&#xe606;</span>
                Linux
            </span>
        
            <span class="sidebar-tag-name" data-tags="Windows">
                <span class="iconfont-archer">&#xe606;</span>
                Windows
            </span>
        
    </div>
    <div class="iconfont-archer sidebar-tags-empty">&#xe678;</div>
    <div class="tag-load-fail" style="display: none; color: #ccc; font-size: 0.6rem;">
        缺失模块，请参考主题文档进行安装配置：https://github.com/fi3ework/hexo-theme-archer#%E5%AE%89%E8%A3%85%E4%B8%BB%E9%A2%98
    </div> 
    <div class="sidebar-tags-list"></div>
</div>

        <div class="sidebar-panel-categories">
    <div class="sidebar-categories-name">
    
    </div>
    <div class="iconfont-archer sidebar-categories-empty">&#xe678;</div>
    <div class="sidebar-categories-list"></div>
</div>

    </div>
</div>

        <!-- site-meta -->
        <script>
    var siteMetaRoot = "/hexo/"
    if (siteMetaRoot === "undefined") {
        siteMetaRoot = '/'
    }
    var siteMeta = {
        url: "https://maplepoet.github.io/hexo",
        root: siteMetaRoot,
        author: "枳暮"
    }
</script>

        <!-- import experimental options here -->
        <!-- Custom Font -->


        <!-- main func -->
        <script src="/hexo/scripts/main.js?v=20211217"></script>
        <!-- dark mode -->
        <script src="/hexo/scripts/dark.js?v=20211217"></script>
        <!-- fancybox -->
        <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js" defer></script>
        <!-- algolia -->
        
        <!-- busuanzi -->
        
            <script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script>
        
        <!-- CNZZ -->
        
        <!-- async load share.js -->
        
            <script src="/hexo/scripts/share.js?v=20211217" async></script>
        
        <!-- mermaid -->
        
    </body>
</html>
